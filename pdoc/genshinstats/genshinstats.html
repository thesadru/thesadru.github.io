<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>genshinstats.genshinstats API documentation</title>
<meta name="description" content="Wrapper for the hoyolab.com gameRecord api â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>genshinstats.genshinstats</code></h1>
</header>
<section id="section-intro">
<p>Wrapper for the hoyolab.com gameRecord api.</p>
<p>Can fetch data for a user's stats like stats, characters, spiral abyss runs&hellip;</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L1-L357" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;Wrapper for the hoyolab.com gameRecord api.

Can fetch data for a user&#39;s stats like stats, characters, spiral abyss runs...
&#34;&#34;&#34;
import hashlib
import json
import random
import string
import time
from http.cookies import SimpleCookie
from typing import Any, Dict, List, Mapping, MutableMapping, Union
from urllib.parse import urljoin

import requests
from requests.sessions import RequestsCookieJar, Session

from .errors import NotLoggedIn, TooManyRequests, raise_for_error
from .pretty import (
    prettify_abyss,
    prettify_activities,
    prettify_characters,
    prettify_notes,
    prettify_stats,
)
from .utils import USER_AGENT, is_chinese, recognize_server, retry

__all__ = [
    &#34;set_cookie&#34;,
    &#34;set_cookies&#34;,
    &#34;get_browser_cookies&#34;,
    &#34;set_cookies_auto&#34;,
    &#34;set_cookie_auto&#34;,
    &#34;fetch_endpoint&#34;,
    &#34;get_user_stats&#34;,
    &#34;get_characters&#34;,
    &#34;get_spiral_abyss&#34;,
    &#34;get_notes&#34;,
    &#34;get_activities&#34;,
    &#34;get_all_user_data&#34;,
]

session = Session()
session.headers.update(
    {
        # required headers
        &#34;x-rpc-app_version&#34;: &#34;&#34;,
        &#34;x-rpc-client_type&#34;: &#34;&#34;,
        &#34;x-rpc-language&#34;: &#34;en-us&#34;,
        # authentications headers
        &#34;ds&#34;: &#34;&#34;,
        # recommended headers
        &#34;user-agent&#34;: USER_AGENT,
    }
)

cookies: List[RequestsCookieJar] = []  # a list of all avalible cookies

OS_DS_SALT = &#34;6cqshh5dhw73bzxn20oexa9k516chk7s&#34;
CN_DS_SALT = &#34;xV8v4Qu54lUKrEYFZkJhB8cuOh9Asafs&#34;
OS_TAKUMI_URL = &#34;https://api-os-takumi.mihoyo.com/&#34;  # overseas
CN_TAKUMI_URL = &#34;https://api-takumi.mihoyo.com/&#34;  # chinese
OS_GAME_RECORD_URL = &#34;https://bbs-api-os.mihoyo.com/game_record/&#34;
CN_GAME_RECORD_URL = &#34;https://api-takumi.mihoyo.com/game_record/app/&#34;


def set_cookie(cookie: Union[Mapping[str, Any], str] = None, **kwargs: Any) -&gt; None:
    &#34;&#34;&#34;Logs-in using a cookie.

    Usage:
    &gt;&gt;&gt; set_cookie(ltuid=..., ltoken=...)
    &gt;&gt;&gt; set_cookie(account_id=..., cookie_token=...)
    &gt;&gt;&gt; set_cookie({&#39;ltuid&#39;: ..., &#39;ltoken&#39;: ...})
    &gt;&gt;&gt; set_cookie(&#34;ltuid=...; ltoken=...&#34;)
    &#34;&#34;&#34;
    if bool(cookie) == bool(kwargs):
        raise ValueError(&#34;Cannot use both positional and keyword arguments at once&#34;)

    set_cookies(cookie or kwargs)


def set_cookies(*args: Union[Mapping[str, Any], str], clear: bool = True) -&gt; None:
    &#34;&#34;&#34;Sets multiple cookies at once to cycle between. Takes same arguments as set_cookie.

    Unlike set_cookie, this function allows for multiple cookies to be used at once.
    This is so far the only way to circumvent the rate limit.

    If clear is set to False the previously set cookies won&#39;t be cleared.
    &#34;&#34;&#34;
    if clear:
        cookies.clear()

    for cookie in args:
        if isinstance(cookie, Mapping):
            cookie = {k: str(v) for k, v in cookie.items()}  # SimpleCookie needs a string
        cookie = SimpleCookie(cookie)

        jar = RequestsCookieJar()
        jar.update(cookie)
        cookies.append(jar)


def get_browser_cookies(browser: str = None) -&gt; Dict[str, str]:
    &#34;&#34;&#34;Gets cookies from your browser for later storing.

    If a specific browser is set, gets data from that browser only.
    Avalible browsers: chrome, chromium, opera, edge, firefox
    &#34;&#34;&#34;
    try:
        import browser_cookie3  # optional library
    except ImportError:
        raise ImportError(
            &#34;functions &#39;set_cookie_auto&#39; and &#39;get_browser_cookie` require \&#34;browser-cookie3\&#34;. &#34;
            &#39;To use these function please install the dependency with &#34;pip install browser-cookie3&#34;.&#39;
        )
    load = getattr(browser_cookie3, browser.lower()) if browser else browser_cookie3.load
    # For backwards compatibility we also get account_id and cookie_token
    # however we can&#39;t just get every cookie because there&#39;s sensitive information
    allowed_cookies = {&#34;ltuid&#34;, &#34;ltoken&#34;, &#34;account_id&#34;, &#34;cookie_token&#34;}
    return {
        c.name: c.value
        for domain in (&#34;mihoyo&#34;, &#34;hoyolab&#34;)
        for c in load(domain_name=domain)
        if c.name in allowed_cookies and c.value is not None
    }


def set_cookie_auto(browser: str = None) -&gt; None:
    &#34;&#34;&#34;Like set_cookie, but gets the cookies by itself from your browser.

    Requires the module browser-cookie3
    Be aware that this process can take up to 10 seconds.
    To speed it up you may select a browser.

    If a specific browser is set, gets data from that browser only.
    Avalible browsers: chrome, chromium, opera, edge, firefox
    &#34;&#34;&#34;
    set_cookies(get_browser_cookies(browser), clear=True)


set_cookies_auto = set_cookie_auto  # alias


def generate_ds(salt: str) -&gt; str:
    &#34;&#34;&#34;Creates a new ds for authentication.&#34;&#34;&#34;
    t = int(time.time())  # current seconds
    r = &#34;&#34;.join(random.choices(string.ascii_letters, k=6))  # 6 random chars
    h = hashlib.md5(f&#34;salt={salt}&amp;t={t}&amp;r={r}&#34;.encode()).hexdigest()  # hash and get hex
    return f&#34;{t},{r},{h}&#34;


def generate_cn_ds(salt: str, body: Any = None, query: Mapping[str, Any] = None) -&gt; str:
    &#34;&#34;&#34;Creates a new chinese ds for authentication.&#34;&#34;&#34;
    t = int(time.time())
    r = random.randint(100001, 200000)
    b = json.dumps(body) if body else &#34;&#34;
    q = &#34;&amp;&#34;.join(f&#34;{k}={v}&#34; for k, v in sorted(query.items())) if query else &#34;&#34;

    h = hashlib.md5(f&#34;salt={salt}&amp;t={t}&amp;r={r}&amp;b={b}&amp;q={q}&#34;.encode()).hexdigest()
    return f&#34;{t},{r},{h}&#34;


# sometimes a random connection error can just occur, mihoyo being mihoyo
@retry(3, requests.ConnectionError)
def _request(*args: Any, **kwargs: Any) -&gt; Any:
    &#34;&#34;&#34;Fancy requests.request&#34;&#34;&#34;
    r = session.request(*args, **kwargs)

    r.raise_for_status()
    kwargs[&#34;cookies&#34;].update(session.cookies)
    session.cookies.clear()
    data = r.json()
    if data[&#34;retcode&#34;] == 0:
        return data[&#34;data&#34;]
    raise_for_error(data)


def fetch_endpoint(
    endpoint: str, chinese: bool = False, cookie: Mapping[str, Any] = None, **kwargs
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Fetch an enpoint from the API.

    Takes in an endpoint url which is joined with the base url.
    A request is then sent and returns a parsed response.
    Includes error handling and ds token renewal.

    Can specifically use the chinese base url and request data for chinese users,
    but that requires being logged in as that user.

    Supports handling ratelimits if multiple cookies are set with `set_cookies`
    &#34;&#34;&#34;
    # parse the arguments for requests.request
    kwargs.setdefault(&#34;headers&#34;, {})
    method = kwargs.pop(&#34;method&#34;, &#34;get&#34;)
    if chinese:
        kwargs[&#34;headers&#34;].update(
            {
                &#34;ds&#34;: generate_cn_ds(CN_DS_SALT, kwargs.get(&#34;json&#34;), kwargs.get(&#34;params&#34;)),
                &#34;x-rpc-app_version&#34;: &#34;2.11.1&#34;,
                &#34;x-rpc-client_type&#34;: &#34;5&#34;,
            }
        )
        url = urljoin(CN_TAKUMI_URL, endpoint)
    else:
        kwargs[&#34;headers&#34;].update(
            {
                &#34;ds&#34;: generate_ds(OS_DS_SALT),
                &#34;x-rpc-app_version&#34;: &#34;1.5.0&#34;,
                &#34;x-rpc-client_type&#34;: &#34;4&#34;,
            }
        )
        url = urljoin(OS_TAKUMI_URL, endpoint)

    if cookie is not None:
        if not isinstance(cookie, MutableMapping) or not all(
            isinstance(v, str) for v in cookie.values()
        ):
            cookie = {k: str(v) for k, v in cookie.items()}
        return _request(method, url, cookies=cookie, **kwargs)
    elif len(cookies) == 0:
        raise NotLoggedIn(&#34;Login cookies have not been provided&#34;)

    for cookie in cookies.copy():
        try:
            return _request(method, url, cookies=cookie, **kwargs)
        except TooManyRequests:
            # move the ratelimited cookie to the end to let the ratelimit wear off
            cookies.append(cookies.pop(0))

    # if we&#39;re here it means we used up all our cookies so we must handle that
    if len(cookies) == 1:
        raise TooManyRequests(&#34;Cannnot get data for more than 30 accounts per day.&#34;)
    else:
        raise TooManyRequests(&#34;All cookies have hit their request limit of 30 accounts per day.&#34;)


def fetch_game_record_endpoint(
    endpoint: str, chinese: bool = False, cookie: Mapping[str, Any] = None, **kwargs
):
    &#34;&#34;&#34;A short-hand for fetching data for the game record&#34;&#34;&#34;
    base_url = CN_GAME_RECORD_URL if chinese else OS_GAME_RECORD_URL
    url = urljoin(base_url, endpoint)
    return fetch_endpoint(url, chinese, cookie, **kwargs)


def get_user_stats(
    uid: int, equipment: bool = False, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets basic user information and stats.

    If equipment is True an additional request will be made to get the character equipment
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/index&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    data = prettify_stats(data)
    if equipment:
        data[&#34;characters&#34;] = get_characters(
            uid, [i[&#34;id&#34;] for i in data[&#34;characters&#34;]], lang, cookie
        )
    return data


def get_characters(
    uid: int, character_ids: List[int] = None, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; List[Dict[str, Any]]:
    &#34;&#34;&#34;Gets characters of a user.

    Characters contain info about their level, constellation, weapon, and artifacts.
    Talents are not included.

    If character_ids are provided then only characters with those ids are returned.
    &#34;&#34;&#34;
    if character_ids is None:
        character_ids = [i[&#34;id&#34;] for i in get_user_stats(uid)[&#34;characters&#34;]]

    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/character&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        method=&#34;POST&#34;,
        json=dict(
            character_ids=character_ids, role_id=uid, server=server
        ),  # POST uses the body instead
        headers={&#34;x-rpc-language&#34;: lang},
    )[&#34;avatars&#34;]
    return prettify_characters(data)


def get_spiral_abyss(
    uid: int, previous: bool = False, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets spiral abyss runs of a user and details about them.

    Every season these stats refresh and you can get the previous stats with `previous`.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    schedule_type = 2 if previous else 1
    data = fetch_game_record_endpoint(
        &#34;genshin/api/spiralAbyss&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid, schedule_type=schedule_type),
    )
    return prettify_abyss(data)


def get_activities(
    uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets the activities of the user

    As of this time only Hyakunin Ikki is availible.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/activities&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    return prettify_activities(data)


def get_notes(uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets the real-time notes of the user

    Contains current resin, expeditions, daily commissions and similar.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/dailyNote&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    return prettify_notes(data)


def get_all_user_data(
    uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Fetches all data a user can has. Very slow.

    A helper function that gets all avalible data for a user and returns it as one dict.
    However that makes it fairly slow so it&#39;s not recommended to use it outside caching.
    &#34;&#34;&#34;
    data = get_user_stats(uid, equipment=True, lang=lang, cookie=cookie)
    data[&#34;spiral_abyss&#34;] = [get_spiral_abyss(uid, previous, cookie) for previous in [False, True]]
    return data</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="genshinstats.genshinstats.fetch_endpoint"><code class="name flex">
<span>def <span class="ident">fetch_endpoint</span></span>(<span>endpoint:Â str, chinese:Â boolÂ =Â False, cookie:Â Mapping[str,Â Any]Â =Â None, **kwargs) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Fetch an enpoint from the API.</p>
<p>Takes in an endpoint url which is joined with the base url.
A request is then sent and returns a parsed response.
Includes error handling and ds token renewal.</p>
<p>Can specifically use the chinese base url and request data for chinese users,
but that requires being logged in as that user.</p>
<p>Supports handling ratelimits if multiple cookies are set with <code><a title="genshinstats.genshinstats.set_cookies" href="#genshinstats.genshinstats.set_cookies">set_cookies()</a></code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L177-L233" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def fetch_endpoint(
    endpoint: str, chinese: bool = False, cookie: Mapping[str, Any] = None, **kwargs
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Fetch an enpoint from the API.

    Takes in an endpoint url which is joined with the base url.
    A request is then sent and returns a parsed response.
    Includes error handling and ds token renewal.

    Can specifically use the chinese base url and request data for chinese users,
    but that requires being logged in as that user.

    Supports handling ratelimits if multiple cookies are set with `set_cookies`
    &#34;&#34;&#34;
    # parse the arguments for requests.request
    kwargs.setdefault(&#34;headers&#34;, {})
    method = kwargs.pop(&#34;method&#34;, &#34;get&#34;)
    if chinese:
        kwargs[&#34;headers&#34;].update(
            {
                &#34;ds&#34;: generate_cn_ds(CN_DS_SALT, kwargs.get(&#34;json&#34;), kwargs.get(&#34;params&#34;)),
                &#34;x-rpc-app_version&#34;: &#34;2.11.1&#34;,
                &#34;x-rpc-client_type&#34;: &#34;5&#34;,
            }
        )
        url = urljoin(CN_TAKUMI_URL, endpoint)
    else:
        kwargs[&#34;headers&#34;].update(
            {
                &#34;ds&#34;: generate_ds(OS_DS_SALT),
                &#34;x-rpc-app_version&#34;: &#34;1.5.0&#34;,
                &#34;x-rpc-client_type&#34;: &#34;4&#34;,
            }
        )
        url = urljoin(OS_TAKUMI_URL, endpoint)

    if cookie is not None:
        if not isinstance(cookie, MutableMapping) or not all(
            isinstance(v, str) for v in cookie.values()
        ):
            cookie = {k: str(v) for k, v in cookie.items()}
        return _request(method, url, cookies=cookie, **kwargs)
    elif len(cookies) == 0:
        raise NotLoggedIn(&#34;Login cookies have not been provided&#34;)

    for cookie in cookies.copy():
        try:
            return _request(method, url, cookies=cookie, **kwargs)
        except TooManyRequests:
            # move the ratelimited cookie to the end to let the ratelimit wear off
            cookies.append(cookies.pop(0))

    # if we&#39;re here it means we used up all our cookies so we must handle that
    if len(cookies) == 1:
        raise TooManyRequests(&#34;Cannnot get data for more than 30 accounts per day.&#34;)
    else:
        raise TooManyRequests(&#34;All cookies have hit their request limit of 30 accounts per day.&#34;)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_activities"><code class="name flex">
<span>def <span class="ident">get_activities</span></span>(<span>uid:Â int, lang:Â strÂ =Â 'en-us', cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets the activities of the user</p>
<p>As of this time only Hyakunin Ikki is availible.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L313-L328" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_activities(
    uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets the activities of the user

    As of this time only Hyakunin Ikki is availible.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/activities&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    return prettify_activities(data)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_all_user_data"><code class="name flex">
<span>def <span class="ident">get_all_user_data</span></span>(<span>uid:Â int, lang:Â strÂ =Â 'en-us', cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Fetches all data a user can has. Very slow.</p>
<p>A helper function that gets all avalible data for a user and returns it as one dict.
However that makes it fairly slow so it's not recommended to use it outside caching.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L347-L357" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_all_user_data(
    uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Fetches all data a user can has. Very slow.

    A helper function that gets all avalible data for a user and returns it as one dict.
    However that makes it fairly slow so it&#39;s not recommended to use it outside caching.
    &#34;&#34;&#34;
    data = get_user_stats(uid, equipment=True, lang=lang, cookie=cookie)
    data[&#34;spiral_abyss&#34;] = [get_spiral_abyss(uid, previous, cookie) for previous in [False, True]]
    return data</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_browser_cookies"><code class="name flex">
<span>def <span class="ident">get_browser_cookies</span></span>(<span>browser:Â strÂ =Â None) â€‘>Â Dict[str,Â str]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets cookies from your browser for later storing.</p>
<p>If a specific browser is set, gets data from that browser only.
Avalible browsers: chrome, chromium, opera, edge, firefox</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L102-L124" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_browser_cookies(browser: str = None) -&gt; Dict[str, str]:
    &#34;&#34;&#34;Gets cookies from your browser for later storing.

    If a specific browser is set, gets data from that browser only.
    Avalible browsers: chrome, chromium, opera, edge, firefox
    &#34;&#34;&#34;
    try:
        import browser_cookie3  # optional library
    except ImportError:
        raise ImportError(
            &#34;functions &#39;set_cookie_auto&#39; and &#39;get_browser_cookie` require \&#34;browser-cookie3\&#34;. &#34;
            &#39;To use these function please install the dependency with &#34;pip install browser-cookie3&#34;.&#39;
        )
    load = getattr(browser_cookie3, browser.lower()) if browser else browser_cookie3.load
    # For backwards compatibility we also get account_id and cookie_token
    # however we can&#39;t just get every cookie because there&#39;s sensitive information
    allowed_cookies = {&#34;ltuid&#34;, &#34;ltoken&#34;, &#34;account_id&#34;, &#34;cookie_token&#34;}
    return {
        c.name: c.value
        for domain in (&#34;mihoyo&#34;, &#34;hoyolab&#34;)
        for c in load(domain_name=domain)
        if c.name in allowed_cookies and c.value is not None
    }</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_characters"><code class="name flex">
<span>def <span class="ident">get_characters</span></span>(<span>uid:Â int, character_ids:Â List[int]Â =Â None, lang:Â strÂ =Â 'en-us', cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â List[Dict[str,Â Any]]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets characters of a user.</p>
<p>Characters contain info about their level, constellation, weapon, and artifacts.
Talents are not included.</p>
<p>If character_ids are provided then only characters with those ids are returned.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L268-L292" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_characters(
    uid: int, character_ids: List[int] = None, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; List[Dict[str, Any]]:
    &#34;&#34;&#34;Gets characters of a user.

    Characters contain info about their level, constellation, weapon, and artifacts.
    Talents are not included.

    If character_ids are provided then only characters with those ids are returned.
    &#34;&#34;&#34;
    if character_ids is None:
        character_ids = [i[&#34;id&#34;] for i in get_user_stats(uid)[&#34;characters&#34;]]

    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/character&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        method=&#34;POST&#34;,
        json=dict(
            character_ids=character_ids, role_id=uid, server=server
        ),  # POST uses the body instead
        headers={&#34;x-rpc-language&#34;: lang},
    )[&#34;avatars&#34;]
    return prettify_characters(data)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_notes"><code class="name flex">
<span>def <span class="ident">get_notes</span></span>(<span>uid:Â int, lang:Â strÂ =Â 'en-us', cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets the real-time notes of the user</p>
<p>Contains current resin, expeditions, daily commissions and similar.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L331-L344" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_notes(uid: int, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets the real-time notes of the user

    Contains current resin, expeditions, daily commissions and similar.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/dailyNote&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    return prettify_notes(data)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_spiral_abyss"><code class="name flex">
<span>def <span class="ident">get_spiral_abyss</span></span>(<span>uid:Â int, previous:Â boolÂ =Â False, cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets spiral abyss runs of a user and details about them.</p>
<p>Every season these stats refresh and you can get the previous stats with <code>previous</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L295-L310" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_spiral_abyss(
    uid: int, previous: bool = False, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets spiral abyss runs of a user and details about them.

    Every season these stats refresh and you can get the previous stats with `previous`.
    &#34;&#34;&#34;
    server = recognize_server(uid)
    schedule_type = 2 if previous else 1
    data = fetch_game_record_endpoint(
        &#34;genshin/api/spiralAbyss&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid, schedule_type=schedule_type),
    )
    return prettify_abyss(data)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.get_user_stats"><code class="name flex">
<span>def <span class="ident">get_user_stats</span></span>(<span>uid:Â int, equipment:Â boolÂ =Â False, lang:Â strÂ =Â 'en-us', cookie:Â Mapping[str,Â Any]Â =Â None) â€‘>Â Dict[str,Â Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Gets basic user information and stats.</p>
<p>If equipment is True an additional request will be made to get the character equipment</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L245-L265" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_user_stats(
    uid: int, equipment: bool = False, lang: str = &#34;en-us&#34;, cookie: Mapping[str, Any] = None
) -&gt; Dict[str, Any]:
    &#34;&#34;&#34;Gets basic user information and stats.

    If equipment is True an additional request will be made to get the character equipment
    &#34;&#34;&#34;
    server = recognize_server(uid)
    data = fetch_game_record_endpoint(
        &#34;genshin/api/index&#34;,
        chinese=is_chinese(uid),
        cookie=cookie,
        params=dict(server=server, role_id=uid),
        headers={&#34;x-rpc-language&#34;: lang},
    )
    data = prettify_stats(data)
    if equipment:
        data[&#34;characters&#34;] = get_characters(
            uid, [i[&#34;id&#34;] for i in data[&#34;characters&#34;]], lang, cookie
        )
    return data</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.set_cookie"><code class="name flex">
<span>def <span class="ident">set_cookie</span></span>(<span>cookie:Â Union[Mapping[str,Â Any],Â str]Â =Â None, **kwargs:Â Any) â€‘>Â None</span>
</code></dt>
<dd>
<div class="desc"><p>Logs-in using a cookie.</p>
<p>Usage:</p>
<pre><code class="language-python-repl">&gt;&gt;&gt; set_cookie(ltuid=..., ltoken=...)
&gt;&gt;&gt; set_cookie(account_id=..., cookie_token=...)
&gt;&gt;&gt; set_cookie({'ltuid': ..., 'ltoken': ...})
&gt;&gt;&gt; set_cookie(&quot;ltuid=...; ltoken=...&quot;)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L66-L78" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_cookie(cookie: Union[Mapping[str, Any], str] = None, **kwargs: Any) -&gt; None:
    &#34;&#34;&#34;Logs-in using a cookie.

    Usage:
    &gt;&gt;&gt; set_cookie(ltuid=..., ltoken=...)
    &gt;&gt;&gt; set_cookie(account_id=..., cookie_token=...)
    &gt;&gt;&gt; set_cookie({&#39;ltuid&#39;: ..., &#39;ltoken&#39;: ...})
    &gt;&gt;&gt; set_cookie(&#34;ltuid=...; ltoken=...&#34;)
    &#34;&#34;&#34;
    if bool(cookie) == bool(kwargs):
        raise ValueError(&#34;Cannot use both positional and keyword arguments at once&#34;)

    set_cookies(cookie or kwargs)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.set_cookie_auto"><code class="name flex">
<span>def <span class="ident">set_cookie_auto</span></span>(<span>browser:Â strÂ =Â None) â€‘>Â None</span>
</code></dt>
<dd>
<div class="desc"><p>Like set_cookie, but gets the cookies by itself from your browser.</p>
<p>Requires the module browser-cookie3
Be aware that this process can take up to 10 seconds.
To speed it up you may select a browser.</p>
<p>If a specific browser is set, gets data from that browser only.
Avalible browsers: chrome, chromium, opera, edge, firefox</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L127-L137" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_cookie_auto(browser: str = None) -&gt; None:
    &#34;&#34;&#34;Like set_cookie, but gets the cookies by itself from your browser.

    Requires the module browser-cookie3
    Be aware that this process can take up to 10 seconds.
    To speed it up you may select a browser.

    If a specific browser is set, gets data from that browser only.
    Avalible browsers: chrome, chromium, opera, edge, firefox
    &#34;&#34;&#34;
    set_cookies(get_browser_cookies(browser), clear=True)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.set_cookies"><code class="name flex">
<span>def <span class="ident">set_cookies</span></span>(<span>*args:Â Union[Mapping[str,Â Any],Â str], clear:Â boolÂ =Â True) â€‘>Â None</span>
</code></dt>
<dd>
<div class="desc"><p>Sets multiple cookies at once to cycle between. Takes same arguments as set_cookie.</p>
<p>Unlike set_cookie, this function allows for multiple cookies to be used at once.
This is so far the only way to circumvent the rate limit.</p>
<p>If clear is set to False the previously set cookies won't be cleared.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L81-L99" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_cookies(*args: Union[Mapping[str, Any], str], clear: bool = True) -&gt; None:
    &#34;&#34;&#34;Sets multiple cookies at once to cycle between. Takes same arguments as set_cookie.

    Unlike set_cookie, this function allows for multiple cookies to be used at once.
    This is so far the only way to circumvent the rate limit.

    If clear is set to False the previously set cookies won&#39;t be cleared.
    &#34;&#34;&#34;
    if clear:
        cookies.clear()

    for cookie in args:
        if isinstance(cookie, Mapping):
            cookie = {k: str(v) for k, v in cookie.items()}  # SimpleCookie needs a string
        cookie = SimpleCookie(cookie)

        jar = RequestsCookieJar()
        jar.update(cookie)
        cookies.append(jar)</code></pre>
</details>
</dd>
<dt id="genshinstats.genshinstats.set_cookies_auto"><code class="name flex">
<span>def <span class="ident">set_cookies_auto</span></span>(<span>browser:Â strÂ =Â None) â€‘>Â None</span>
</code></dt>
<dd>
<div class="desc"><p>Like set_cookie, but gets the cookies by itself from your browser.</p>
<p>Requires the module browser-cookie3
Be aware that this process can take up to 10 seconds.
To speed it up you may select a browser.</p>
<p>If a specific browser is set, gets data from that browser only.
Avalible browsers: chrome, chromium, opera, edge, firefox</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/thesadru/genshinstats/blob/master/genshinstats/genshinstats.py#L127-L137" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_cookie_auto(browser: str = None) -&gt; None:
    &#34;&#34;&#34;Like set_cookie, but gets the cookies by itself from your browser.

    Requires the module browser-cookie3
    Be aware that this process can take up to 10 seconds.
    To speed it up you may select a browser.

    If a specific browser is set, gets data from that browser only.
    Avalible browsers: chrome, chromium, opera, edge, firefox
    &#34;&#34;&#34;
    set_cookies(get_browser_cookies(browser), clear=True)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<form>
<input id="lunr-search" name="q" placeholder="ðŸ”Ž Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="genshinstats" href="index.html">genshinstats</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="genshinstats.genshinstats.fetch_endpoint" href="#genshinstats.genshinstats.fetch_endpoint">fetch_endpoint</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_activities" href="#genshinstats.genshinstats.get_activities">get_activities</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_all_user_data" href="#genshinstats.genshinstats.get_all_user_data">get_all_user_data</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_browser_cookies" href="#genshinstats.genshinstats.get_browser_cookies">get_browser_cookies</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_characters" href="#genshinstats.genshinstats.get_characters">get_characters</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_notes" href="#genshinstats.genshinstats.get_notes">get_notes</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_spiral_abyss" href="#genshinstats.genshinstats.get_spiral_abyss">get_spiral_abyss</a></code></li>
<li><code><a title="genshinstats.genshinstats.get_user_stats" href="#genshinstats.genshinstats.get_user_stats">get_user_stats</a></code></li>
<li><code><a title="genshinstats.genshinstats.set_cookie" href="#genshinstats.genshinstats.set_cookie">set_cookie</a></code></li>
<li><code><a title="genshinstats.genshinstats.set_cookie_auto" href="#genshinstats.genshinstats.set_cookie_auto">set_cookie_auto</a></code></li>
<li><code><a title="genshinstats.genshinstats.set_cookies" href="#genshinstats.genshinstats.set_cookies">set_cookies</a></code></li>
<li><code><a title="genshinstats.genshinstats.set_cookies_auto" href="#genshinstats.genshinstats.set_cookies_auto">set_cookies_auto</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>